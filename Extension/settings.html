<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Click-a-Vent 設定</title>
  <link rel="stylesheet" href="settings.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Click-a-Vent 設定</h1>
      <button id="settings-help-btn" class="help-icon-btn" title="ヘルプ">
        <img src="icons/help.svg" width="24" height="24" alt="ヘルプ">
      </button>
    </header>

    <!-- タブナビゲーション -->
    <nav class="tabs">
      <button class="tab-btn active" data-tab="auto-config">自動抽出</button>
      <button class="tab-btn" data-tab="duration-config">期間ボタン</button>
      <button class="tab-btn" data-tab="date-format">日付設定</button>
      <button class="tab-btn" data-tab="time-format">時刻設定</button>
      <button class="tab-btn" data-tab="history">履歴</button>
    </nav>

    <!-- 自動抽出タブ -->
    <div class="tab-content active" id="auto-config">
      <div class="split-layout">
        <!-- 左側：URLリスト -->
        <div class="left-panel">
          <h2>登録済みURL</h2>
          <div class="url-list" id="url-list">
            <!-- 動的に生成 -->
          </div>
          <div class="control-buttons">
            <button id="move-up-btn" class="control-btn" disabled>↑</button>
            <button id="move-down-btn" class="control-btn" disabled>↓</button>
            <button id="new-btn" class="control-btn">新規</button>
            <button id="delete-btn" class="control-btn" disabled>削除</button>
          </div>
        </div>

        <!-- 右側：詳細情報 -->
        <div class="right-panel">
          <h2>詳細設定</h2>
          <form id="auto-config-form">
            <div class="form-group">
              <label for="config-title">タイトル <span class="required">*</span></label>
              <input type="text" id="config-title" placeholder="イベント名など" required>
              <small>URLリストに表示されます</small>
            </div>
            
            <div class="form-group">
              <label for="config-url">URL <span class="required">*</span></label>
              <input type="text" id="config-url" placeholder="https://example.com/events/" required>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="config-use-regex">
                  正規表現を使う
                </label>
              </div>
              <small id="url-hint">前方一致でマッチします</small>
            </div>
            
            <div class="form-group">
              <label for="config-event-xpath">イベント名のXPath <span class="required">*</span></label>
              <input type="text" id="config-event-xpath" placeholder="/html/body/div[1]/h1" required>
            </div>
            
            <div class="form-group">
              <label for="config-datetime-xpath">開始日時のXPath</label>
              <input type="text" id="config-datetime-xpath" placeholder="/html/body/div[2]/time">
            </div>
            
            <div class="form-group">
              <label for="config-location-xpath">場所のXPath</label>
              <input type="text" id="config-location-xpath" placeholder="/html/body/div[3]/span">
            </div>
            
            <div class="button-group-horizontal">
              <button type="submit" id="submit-config-btn" class="primary-btn" disabled>追加</button>
              <button type="button" id="url-test-btn" class="secondary-btn">URLテスト</button>
            </div>
            
            <div id="url-test-section" class="url-test-section hidden">
              <div class="form-group">
                <label for="test-url-input">テストURL</label>
                <input type="text" id="test-url-input" placeholder="テストURL">
                <div id="test-url-result" class="test-url-result"></div>
              </div>
              
              <div class="history-test-results" id="history-test-results">
                <h3>履歴との照合結果</h3>
                <div id="history-match-list" class="history-match-list"></div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- 日付設定タブ -->
    <div class="tab-content" id="date-format">
      <h2>日付フォーマット設定</h2>
      <p class="description">
        テキストから日付を抽出するフォーマットを設定します。<br>
        %Y=年、%M=月、%D=日（小文字も可）<br>
        上から順にマッチし、最初にマッチしたフォーマットが使用されます。
      </p>
      
      <div class="format-section">
        <label for="date-format-input">日付フォーマット(1行に1つ)</label>
        <textarea id="date-format-input" rows="10" placeholder="%Y年%M月%D日
%M月%D日
%Y/%M/%D
%M/%D
%Y-%M-%D
%M-%D
%Y.%M.%D
%M.%D"></textarea>
        
        <div class="button-group">
          <button id="save-date-btn" class="primary-btn" disabled>登録</button>
          <button id="test-date-btn" class="secondary-btn">テスト</button>
          <button id="reset-date-btn" class="secondary-btn">デフォルトに戻す</button>
        </div>
        
        <div id="date-test-section" class="test-input-section" style="display: none;">
          <label for="date-test-input">テスト用テキスト</label>
          <input type="text" id="date-test-input" placeholder="例: 2025年12月25日 14:30">
          <div id="date-test-parse-result" class="parse-result"></div>
        </div>
        
        <div id="date-test-result" class="test-result"></div>
      </div>
    </div>

    <!-- 時刻設定タブ -->
    <div class="tab-content" id="time-format">
      <h2>時刻フォーマット設定</h2>
      <p class="description">
        テキストから時刻を抽出するフォーマットを設定します。<br>
        %H=時、%M=分、%P=午前/午後（小文字も可、分は省略可）<br>
        上から順にマッチし、最初にマッチしたフォーマットが使用されます。
      </p>
      
      <div class="format-section">
        <label for="time-format-input">時刻フォーマット（1行に1つ）</label>
        <textarea id="time-format-input" rows="10" placeholder="%H:%M
%H：%M
%P%H時%M分
%P%H時
%H時%M分
%H時"></textarea>
        
        <div class="button-group">
          <button id="save-time-btn" class="primary-btn" disabled>登録</button>
          <button id="test-time-btn" class="secondary-btn">テスト</button>
          <button id="reset-time-btn" class="secondary-btn">デフォルトに戻す</button>
        </div>
        
        <div id="time-test-section" class="test-input-section" style="display: none;">
          <label for="time-test-input">テスト用テキスト</label>
          <input type="text" id="time-test-input" placeholder="例: 2025年12月25日 14:30">
          <div id="time-test-parse-result" class="parse-result"></div>
        </div>
        
        <div id="time-test-result" class="test-result"></div>
      </div>
    </div>

    <!-- 期間ボタンタブ -->
    <div class="tab-content" id="duration-config">
      <div class="split-layout">
        <!-- 左側：期間ボタンリスト -->
        <div class="left-panel">
          <h2>登録済み期間ボタン</h2>
          <div class="url-list" id="duration-list">
            <!-- 動的に生成 -->
          </div>
          <div class="control-buttons">
            <button id="duration-move-up-btn" class="control-btn" disabled>↑</button>
            <button id="duration-move-down-btn" class="control-btn" disabled>↓</button>
            <button id="duration-new-btn" class="control-btn">新規</button>
            <button id="duration-delete-btn" class="control-btn" disabled>削除</button>
          </div>
        </div>

        <!-- 右側：詳細情報 -->
        <div class="right-panel">
          <h2>詳細設定</h2>
          <form id="duration-config-form">
            <div class="form-group">
              <label for="duration-button-name">ボタン名 <span class="required">*</span></label>
              <input type="text" id="duration-button-name" placeholder="1時間" required>
            </div>
            
            <div class="form-group">
              <label for="duration-value">期間 <span class="required">*</span></label>
              <input type="text" id="duration-value" placeholder="1h, 30m, 2h30m, 1d" required>
              <small>m=分, h=時間, d=日 (例: 30m, 2h, 2h30m, 1d)</small>
              <div id="duration-parse-result" class="parse-result" style="margin-top: 8px;"></div>
            </div>
            
            <div class="form-group">
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" id="duration-is-default">
                  デフォルトに設定
                </label>
              </div>
              <small>デフォルトは1つのみ設定可能です</small>
            </div>
            
            <div class="button-group-horizontal">
              <button type="submit" id="submit-duration-btn" class="primary-btn" disabled>追加</button>
            </div>
          </form>
        </div>
      </div>
      
      <!-- 自由入力欄の配置設定 -->
      <div style="max-width: 600px; margin-top: 30px;">
        <div class="form-group">
          <label for="custom-input-position">自由入力欄の配置</label>
          <select id="custom-input-position" class="form-control" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
            <option value="start">先頭</option>
            <option value="end" selected>末尾</option>
            <option value="hidden">非表示</option>
          </select>
          <small>ポップアップ画面での自由入力欄の表示位置を設定します</small>
        </div>
      </div>
    </div>

    <!-- 履歴タブ -->
    <div class="tab-content" id="history">
      <div class="history-header-row">
        <h2>登録履歴（最新30件）</h2>
        <div class="history-option">
          <label class="checkbox-label">
            <input type="checkbox" id="add-as-regex">
            正規表現で追加
          </label>
        </div>
      </div>
      
      <div id="history-list" class="history-list">
        <!-- 動的に生成 -->
      </div>
      
      <div id="no-history" class="no-data">
        まだ登録履歴がありません
      </div>
    </div>
  </div>

  <script src="utils.js"></script>
  <script src="settings.js"></script>
</body>
</html>
