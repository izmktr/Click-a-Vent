設定画面を作ってください

設定画面はアイコンをクリックした時のウィンドウに
設定画面へのアイコンがあります
これを押した時に、新しいタブとして開きます

設定画面は以下の項目からなります
自動設定、日付設定、時刻設定はChromeSyncStorageに保存し、
履歴はローカルに保存します
保存時に、データ上限の80％を超えている場合は警告を出してください

これらは縦に並べて表示します
・自動設定
・日付設定
・時刻設定
・履歴


自動設定
これは、アイコンをクリックしてページを開いた時、
現在開いているページがURLと前方一致した場合、
残った部分のXPATHから要素を自動的に拾います

URLは上からマッチして、どこかでマッチしたら打ち切ります

画面は左にURLのリスト、右に情報を出します

URLのリストの下には「↑」「↓」「新規」「削除」があります
それぞれ、選べないときはグレーアウトします

↑は現在のリストの要素を上に移動します
↓は現在のリストの要素を下に移動します
新規はリストの選択を無効化して、右の詳細部分を初期化します
削除は現在のリストの要素を削除します

情報は、リストを選択した場合はその項目の情報を
新規が押された場合は空欄を表示します

項目は「URL」「イベント名」「開始時刻」「場所」をテキストボックスで設定し
下に、「追加」のボタンを追加します
「追加」のボタンは、新規を押している場合やデフォルトの場合のみで
リストを押して項目を選んでいる場合は「更新」になります

「追加」は「URL」、「イベント名」が入っていないときは無効化します
リストを選んで表示したときは「更新」は無効化して、
どこかを編集した場合、編集したテキストボックスを淡赤にして更新を有効化します

登録エラーに関して
以下の場合はエラーダイアログを出し、その項目を淡赤背景にしてください
・URLが他のURLと競合する(一方型法の部分一致に合致する)
・XPATHが不正な場合
他、エラーと思われる場合は同様です


日付設定
開始日付をクリックした時、テキストから日付に変換するときのフォーマットを指定します
%Y,%M,%Dを正規表現の"\d+"とみなしてテキストを検索して、
%Yを年、%Mを月、%Dを日として日付に変換します
年は省略可能で、省略された時、月日が現在日時に対して3ヶ月以上前の場合、来年のデータとし、
それ以外は今年のデータとします
%y,%m,%dがある場合は保存時に大文字に変換します
上からマッチし、どこかでマッチしたらそれより下のデータはマッチしません

ここは、マルチラインのテキストボックスを配置し、下に「テスト」「登録」ボタンを入れます
「テスト」は履歴に対して、開始日付の情報をマッチし、どこにもマッチしない場合は赤背景にします
但し、開始日付のデータ内に数字が含まれてない場合は無視します
テキストボックスが編集された時に登録ボタンを有効化し、
登録を押してデータを保存します

フォーマットエラーがある場合、エラーダイアログを出します

デフォルトで以下のデータが入っています
%Y年%M月%D日
%M月%D日
%M/%D

時刻設定
日付設定と同様ですが、開始日付から時刻に変換するときのフォーマットを指定します
%H,%Mを正規表現の"\d+"とみなしてテキストを検索して、
%Hを時間、%Mを分として時刻に変換します
%Mは省略可能で、0とします
上からマッチし、どこかでマッチしたらそれより下のデータはマッチしません

デフォルトで以下のデータが入っています
%H:%M
%H：%M
%H時%M分
%H時

履歴
履歴はこれまでの登録データを30件記録し、表示します

表示形式は折りたたみ式テーブルとします
デフォルトは全て折りたたまれた状態で、行全体をクリックすると展開/折りたたみを切り替えます

折りたたみ時の表示項目：
・登録日時
・ページURL
・イベント名
・「この設定で自動設定を追加」ボタン

展開時の追加表示項目：
・イベント名のXPath
・日付と開始時刻、そのXPath
・場所、そのXPath

また、「この設定で自動設定を追加」のボタンを各履歴に配置してください
これを押した場合、自動設定の欄に新規追加として情報が設定されます
即座に追加して、現在の入力中情報は破棄します

